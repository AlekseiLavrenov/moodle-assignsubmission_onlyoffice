{"version":3,"file":"editor.min.js","sources":["../src/editor.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module assignsubmission_onlyoffice/editor\n * @copyright  2023 Ascensio System SIA <integration@onlyoffice.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine(['jquery'], function($) {\n    var docEditor = null;\n\n    var openEditor = function(contextid, itemid, readonly, tmplkey = null) {\n        if (typeof DocsAPI === 'undefined') {\n            return;\n        }\n\n        var params = {\n            contextid: contextid,\n            itemid: itemid\n        };\n\n        if (readonly) {\n            params.readonly = readonly;\n        }\n        if (tmplkey) {\n            params.tmplkey = tmplkey;\n        }\n\n        var ajaxUrl = M.cfg.wwwroot + '/mod/assign/submission/onlyoffice/api/editorconfig.php';\n        $.getJSON(ajaxUrl, params).done(function(config) {\n\n            // eslint-disable-next-line no-undef\n            docEditor = new DocsAPI.DocEditor('onlyoffice-editor', config);\n\n            if ($('div#topofscroll').length > 0) {\n                $('div#topofscroll').addClass('assignsubmission-onlyoffice-display');\n            }\n        });\n    };\n\n    return {\n        init: function(documentserverurl, contextid, itemid, readonly, tmplkey) {\n            var docsapijs = document.createElement('script');\n            docsapijs.type = 'text/javascript';\n\n            $(docsapijs).appendTo('#app');\n            $(docsapijs).on('load', function() {\n                if (!tmplkey) {\n                    openEditor(contextid, itemid, readonly);\n                } else {\n                    let formatelement = $('input#id_assignsubmission_onlyoffice_format');\n                    let selectformat = $('select#id_assignsubmission_onlyoffice_format');\n                    let enableapptoggle = $('input#id_assignsubmission_onlyoffice_enabled');\n\n                    if (enableapptoggle.length == 0) {\n                        return;\n                    }\n\n                    if (enableapptoggle[0].checked\n                        && formatelement.length > 0 && formatelement[0].value == 'docxf') {\n                        openEditor(contextid, itemid, readonly, tmplkey);\n                    }\n\n                    enableapptoggle.change(function(e) {\n                        if (e.currentTarget.checked\n                            && (formatelement.length > 0 && formatelement[0].value == 'docxf'\n                            || selectformat.length > 0 && selectformat[0].value == 'docxf')) {\n\n                            if (docEditor === null) {\n                                openEditor(contextid, itemid, readonly, tmplkey);\n                            }\n\n                            $(\"#app\").show();\n\n                            return;\n                        }\n\n                        $(\"#app\").hide();\n                    });\n\n                    if (selectformat.length > 0) {\n                        selectformat.change(function(e) {\n                            if (e.target.value != 'docxf') {\n                                if ($(\"#app\").is(\":visible\")) {\n                                    $(\"#app\").hide();\n                                }\n                                return;\n                            }\n\n                            if (docEditor === null) {\n                                openEditor(contextid, itemid, readonly, tmplkey);\n                            }\n\n                            $(\"#app\").show();\n                        });\n                    }\n                }\n            });\n\n            docsapijs.src = documentserverurl + '/web-apps/apps/api/documents/api.js';\n        }\n    };\n});\n"],"names":["define","$","docEditor","openEditor","contextid","itemid","readonly","tmplkey","DocsAPI","params","ajaxUrl","M","cfg","wwwroot","getJSON","done","config","DocEditor","length","addClass","init","documentserverurl","docsapijs","document","createElement","type","appendTo","on","formatelement","selectformat","enableapptoggle","checked","value","change","e","currentTarget","show","hide","target","is","src"],"mappings":";;;;;AAoBAA,4CAAO,CAAC,WAAW,SAASC,OACpBC,UAAY,KAEZC,WAAa,SAASC,UAAWC,OAAQC,cAAUC,+DAAU,QACtC,oBAAZC,aAIPC,OAAS,CACTL,UAAWA,UACXC,OAAQA,QAGRC,WACAG,OAAOH,SAAWA,UAElBC,UACAE,OAAOF,QAAUA,aAGjBG,QAAUC,EAAEC,IAAIC,QAAU,yDAC9BZ,EAAEa,QAAQJ,QAASD,QAAQM,MAAK,SAASC,QAGrCd,UAAY,IAAIM,QAAQS,UAAU,oBAAqBD,QAEnDf,EAAE,mBAAmBiB,OAAS,GAC9BjB,EAAE,mBAAmBkB,SAAS,kDAKnC,CACHC,KAAM,SAASC,kBAAmBjB,UAAWC,OAAQC,SAAUC,aACvDe,UAAYC,SAASC,cAAc,UACvCF,UAAUG,KAAO,kBAEjBxB,EAAEqB,WAAWI,SAAS,QACtBzB,EAAEqB,WAAWK,GAAG,QAAQ,cACfpB,QAEE,KACCqB,cAAgB3B,EAAE,+CAClB4B,aAAe5B,EAAE,gDACjB6B,gBAAkB7B,EAAE,mDAEM,GAA1B6B,gBAAgBZ,cAIhBY,gBAAgB,GAAGC,SAChBH,cAAcV,OAAS,GAA+B,SAA1BU,cAAc,GAAGI,OAChD7B,WAAWC,UAAWC,OAAQC,SAAUC,SAG5CuB,gBAAgBG,QAAO,SAASC,MACxBA,EAAEC,cAAcJ,UACZH,cAAcV,OAAS,GAA+B,SAA1BU,cAAc,GAAGI,OAC9CH,aAAaX,OAAS,GAA8B,SAAzBW,aAAa,GAAGG,cAE5B,OAAd9B,WACAC,WAAWC,UAAWC,OAAQC,SAAUC,cAG5CN,EAAE,QAAQmC,OAKdnC,EAAE,QAAQoC,UAGVR,aAAaX,OAAS,GACtBW,aAAaI,QAAO,SAASC,GACH,SAAlBA,EAAEI,OAAON,OAOK,OAAd9B,WACAC,WAAWC,UAAWC,OAAQC,SAAUC,SAG5CN,EAAE,QAAQmC,QAVFnC,EAAE,QAAQsC,GAAG,aACbtC,EAAE,QAAQoC,eApC1BlC,WAAWC,UAAWC,OAAQC,aAmDtCgB,UAAUkB,IAAMnB,kBAAoB"}